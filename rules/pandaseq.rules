import subprocess
from scripts.setting import SeqIndex
import os


rule run_pandaseq:
    input:
        "Split/{dir}/" + LIBRARY + ".R1.fastq",
        "Split/{dir}/" + LIBRARY + ".R2.fastq"
    output:
        "QC/{dir}/pandaseq.fq"
    params:
        job_name = "Pand",
        cluster = "-cwd -l vf=1G -e logs/ -o logs/"
    threads:
        1
    log:
        "QC/{dir}/pandaseq.log"
    run:
        data_type = wildcards.dir.split("/")[-2].split("_")[1]
        if os.stat(input[0]).st_size and os.stat(input[1]).st_size:
            cmd = " ".join(
            ["-T {threads}",
            "-F",
            "-f {input[0]}",
            "-r {input[1]}",
            "-p " + SeqIndex.primer[LIB_TYPE][data_type]['forward'],
            "-q " + SeqIndex.primer[LIB_TYPE][data_type]['reverse'],
            "-w {output}",
            "-l 220",
            "-L 500",
            "-g {log}"])
            shell(PANDASEQ + " " + cmd)
        else:
            shell("touch {output}")
            shell("echo 'No reads in this sample.' > {log}")
